!function(e){var o={};function t(s){if(o[s])return o[s].exports;var l=o[s]={i:s,l:!1,exports:{}};return e[s].call(l.exports,l,l.exports,t),l.l=!0,l.exports}t.m=e,t.c=o,t.d=function(e,o,s){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:s})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var l in e)t.d(s,l,function(o){return e[o]}.bind(null,l));return s},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p="",t(t.s=0)}([function(e,o,t){const s=t(1);let l=document.querySelector("#shade"),i=document.querySelector("#select"),n=document.querySelector("#map");function r(e=1e3){return new Promise(o=>setTimeout(o,e))}!function(){n.style.height=innerHeight+"px",n.style.width=innerHeight+"px";let e=(innerWidth-innerHeight)/2;n.style.position="absolute",n.style.left=e+"px"}(),window.starTime=0,window.interval=0;let c=2,a=[2,4,6];$(".people").click((function(){$(this).hasClass("active")||(config.playSound("select"),$(this).removeClass("btn").addClass("active").siblings().removeClass("active").addClass("btn"),c=1*$(this).data("people"))})),$(".num").click((function(){if(!$(this).hasClass("active"))switch(config.playSound("select"),$(this).removeClass("btn").addClass("active").siblings().removeClass("active").addClass("btn"),$(this).data("num")){case"2,4,6":a=[2,4,6];break;case"5,6":a=[5,6];break;case"6,":a=[6]}})),$("#play_game").click((function(){config.playSound("select"),config.startGameCMD()})),window.startGame=function(){$(this).removeClass("options-start-game").addClass("options-start-game-active").find("img").attr("src","./images/options/txt_play_clicked.png"),console.log(c),d=new _(c),l.style.display="none",i.style.display="none"},$("#restart").click((function(){config.gameOverCMD()}));const p=innerHeight/16;let d,m=[],h=null;class _{constructor(e){switch(this.player_num=e,this.current_player=null,this.players_color=[],this.player_num){case 2:m=[new g(1),new g(3)],this.current_player=Math.floor(2*Math.random()),this.players_color=[1,3],h=new u(this.players_color[this.current_player]),m[this.current_player].switch_avatar(!0);break;case 3:m=[new g(1),new g(3),new g(4)],this.current_player=Math.floor(3*Math.random()),this.players_color=[1,3,4],h=new u(this.players_color[this.current_player]),m[this.current_player].switch_avatar(!0);break;case 4:m=[new g(1),new g(2),new g(3),new g(4)],this.current_player=Math.floor(4*Math.random()),this.players_color=[1,2,3,4],h=new u(this.players_color[this.current_player]),m[this.current_player].switch_avatar(!0)}}static check_collision(e,o){for(let t=0;t<m.length;t++)if(m[t].col!==e)for(let s=0;s<4;s++)"circle"===m[t].ships[s].pos&&m[t].ships[s].pos_index===o&&(3===e?config.tellEMO("attack"):3===m[t].col&&config.tellEMO("attacked"),m[t].ships[s].hit());!async function(){console.log("Do some thing, "+new Date),await r(2e3),console.log("Do other things, "+new Date)}()}check_for_winner(){let e=this;for(let o=0;o<4;o++)if(!m[e.current_player].ships[o].complete)return!1;return console.log("--------------PLAYER "+e.players_color[e.current_player]+"------------"),$("#winner-header").attr("src","./images/victory/winner_"+e.players_color[e.current_player]+".png"),$("#shade").css("display","block"),$("#winner").css("display","block"),config.playSound("victory"),3==e.players_color[e.current_player]?(config.tellEMO("emowins"),!0):(config.tellEMO("emoloses"),!0)}}class u{constructor(e){let o=this;this.roll_num=null,this.dom=document.createElement("div"),3===e&&(this.dom.style.display="none"),this.rolled=!1,this.pos=s.dice[e],this.dom.style.width=1.4*p+"px",this.dom.style.height=1.4*p+"px",this.dom.style.backgroundImage="url(images/dice.gif)",this.dom.style.backgroundSize="cover",n.appendChild(this.dom),this.dom.style.position="absolute",this.dom.style.left=this.pos[0]*p+"px",this.dom.style.top=this.pos[1]*p+"px",this.dom.addEventListener("click",(function(){if(!o.rolled){config.playSound("dicerolled"),o.rolled=!0,o.roll_num=Math.floor(6*Math.random()+1),o.dom.style.backgroundImage="url(images/dice_"+o.roll_num+".png)";let e=!0;for(let t=0;t<4;t++){let s=m[d.current_player].ships[t];console.log(s.complete),(s.take_off||a.indexOf(o.roll_num)>-1)&&!s.complete&&(console.log("ship"+(t+1)+" can move, set ship.mobility = true"),e=!1,s.mobilily=!0,s.set_dom_image("active"))}e&&setTimeout((function(){o.call_for_next_round()}),1e3)}})),3===e&&config.tellEMO("rolladice")}call_for_next_round(){let e=this,o=(new Date).getTime(),t=window.starTime+window.interval;r(t-o>=0?t-o:0).then((function(){console.log("call for next round"),6===e.roll_num?(3===d.players_color[d.current_player]&&(e.dom.style.display="none",config.tellEMO("rolladice")),e.dom.style.backgroundImage="url(images/dice.gif)",e.rolled=!1):(m[d.current_player].switch_avatar(!1),d.current_player++,d.current_player=d.current_player>m.length-1?0:d.current_player,m[d.current_player].switch_avatar(!0),3===d.players_color[d.current_player]?(e.dom.style.display="none",config.tellEMO("rolladice")):e.dom.style.display="block",e.pos=s.dice[d.players_color[d.current_player]],e.dom.style.left=e.pos[0]*p+"px",e.dom.style.top=e.pos[1]*p+"px",e.dom.style.backgroundImage="url(images/dice.gif)",e.rolled=!1)}))}}window.listenToEMO=function(e){let o=decodeURIComponent(e);if(o.indexOf("dicenum")>-1){h.rolled=!0,h.roll_num=parseInt(o[7]),h.dom.style.backgroundImage="url(images/dice_"+h.roll_num+".png)";let e=!0,t=[];for(let o=0;o<4;o++){let s=m[d.current_player].ships[o];(s.take_off||a.indexOf(h.roll_num)>-1)&&!s.complete&&(console.log("ship"+(o+1)+" can move, set ship.mobility = true"),t.push(s),e=!1,s.mobilily=!0,s.set_dom_image("active"))}if(e&&setTimeout((function(){h.call_for_next_round()}),1e3),0===t.length)return void config.tellEMO("cantmove");for(let e=0;e<t.length;e++)if(!t[e].take_off)return t[e].dom.click();t[Math.floor(Math.random()*t.length)].dom.click()}};class g{constructor(e){this.col=e,this.pos=s.player[this.col],this.ships=[new f(e,1),new f(e,2),new f(e,3),new f(e,4)],this.avatar_dom=document.createElement("div"),this.avatar_dom.style.width=4*p+"px",this.avatar_dom.style.height=4*p+"px",this.avatar_dom.style.backgroundImage="url(images/player_"+this.col+"_inactive.png)",this.avatar_dom.style.backgroundSize="cover",n.appendChild(this.avatar_dom),this.avatar_dom.style.position="absolute",this.avatar_dom.style.left=this.pos[0]*p+"px",this.avatar_dom.style.top=this.pos[1]*p+"px"}switch_avatar(e){this.avatar_dom.style.backgroundImage=e?"url(images/player_"+this.col+"_active.png)":"url(images/player_"+this.col+"_inactive.png)"}}class f{constructor(e,o){let t=this;this.col=e,this.ind=o,this.ori_towards=[90,180,-90,0][this.col-1],this.mobilily=!1,this.take_off=!1,this.pos="base",this.pos_index=this.ind,this.pos_coord=s.base[this.col][o],this.complete=!1,this.dom=document.createElement("div"),this.dom.style.width=p+"px",this.dom.style.height=p+"px",this.dom.style.transform="rotate("+this.ori_towards+"deg)",this.dom.style.backgroundImage="url(images/ship_"+this.col+".png)",this.dom.style.backgroundSize="cover",n.appendChild(this.dom),this.dom.style.position="absolute",this.dom.style.left=(this.pos_coord[0]-.5)*p+"px",this.dom.style.top=(this.pos_coord[1]-.5)*p+"px",this.dom.addEventListener("click",(function(){if(t.mobilily){for(let e=0;e<4;e++)m[d.current_player].ships[e].mobilily=!1,m[d.current_player].ships[e].complete||m[d.current_player].ships[e].set_dom_image("normal");console.log("ship_"+o+" clicked, this ship can move");let e="base",l=0,i=[0,0];t.take_off?"platform"===t.pos?(e="circle",l=[39,0,13,26][t.col-1]+h.roll_num,i=s.circle[l]):"circle"===t.pos?t.pos_index<=[37,50,11,24][t.col-1]&&t.pos_index+h.roll_num>[37,50,11,24][t.col-1]?(e="straight",l=t.pos_index+h.roll_num-[37,50,11,24][t.col-1],i=s.straight[t.col][l]):t.pos_index+h.roll_num>52?(e="circle",l=t.pos_index+h.roll_num-52,i=s.circle[l]):(e="circle",l=t.pos_index+h.roll_num,i=s.circle[l]):"straight"===t.pos&&(t.pos_index+h.roll_num>6?(e="straight",l=12-t.pos_index-h.roll_num,i=s.straight[t.col][l]):(e="straight",l=t.pos_index+h.roll_num,i=s.straight[t.col][l])):(t.take_off=!0,e="platform",l=0,i=s.base[t.col][0]),t.move_to(e,l,i,"fly",(function(){if("straight"===t.pos&&6===l)console.log("this ship has accomplished"),3===t.col?config.tellEMO("accomplished"):config.tellEMO("sbaccomplished"),t.accomplish()||h.call_for_next_round();else if("circle"===t.pos)if(_.check_collision(t.col,t.pos_index),t.pos_index===[5,18,31,44][t.col-1])console.log("this ship can cross and jump"),3===t.col&&config.tellEMO("cross"),t.move_to("circle",[17,30,43,4][t.col-1],s.circle[[17,30,43,4][t.col-1]],"cross",(function(){_.check_collision(t.col,t.pos_index),t.move_to("circle",[21,34,47,8][t.col-1],s.circle[[21,34,47,8][t.col-1]],"jump",(function(){console.log("stop cross and jump, current attributes are: pos: "+t.pos+", pos_index: "+t.pos_index+"pos_coord: "+t.pos_coord),_.check_collision(t.col,t.pos_index),h.call_for_next_round()}))}));else if((t.pos_index%4===t.col||t.pos_index%4==0&&4===t.col)&&t.pos_index!==[37,50,11,24][t.col-1]){console.log("this ship can jump"),3===t.col&&config.tellEMO("jump");let e=t.pos_index+4>52?t.pos_index+4-52:t.pos_index+4,o=s.circle[e];t.move_to("circle",e,o,"jump",(function(){console.log("stop jump"),_.check_collision(t.col,t.pos_index),t.pos_index===[5,18,31,44][t.col-1]?(console.log("this ship can cross"),t.move_to("circle",[17,30,43,4][t.col-1],s.circle[[17,30,43,4][t.col-1]],"cross",(function(){console.log("stop crossing"),_.check_collision(t.col,t.pos_index),h.call_for_next_round()}))):h.call_for_next_round()}))}else h.call_for_next_round();else h.call_for_next_round()}))}}))}move_to(e,o,t,s="fly",l){switch(s){case"fly":config.playSound("fly");break;case"jump":config.playSound("jump");break;case"cross":config.playSound("cross")}this.set_dom_image("flying"),console.log("start moving to: "+e+", "+o+", "+t),console.log(this.dom.style.transform+"--------"+this.dom.style.left+"-------"+this.dom.style.top);let i=this,n=parseInt(i.dom.style.transform.substring(7,i.dom.style.transform.indexOf("deg)"))),r=parseInt(180*Math.atan2(t[1]-i.pos_coord[1],t[0]-i.pos_coord[0])/Math.PI+90);console.log("current angle: "+n),r=r>180?r-360:r,console.log("target angle: "+r),n===r?$(i.dom).animate({left:(t[0]-.5)*p+"px",top:(t[1]-.5)*p+"px"},1e3,"linear",(function(){i.pos=e,i.pos_index=o,i.pos_coord=t,console.log("stop moving, updating attr, pos: "+i.pos+", pos_index: "+i.pos_index+"pos_coord: "+i.pos_coord),i.set_dom_image("normal"),l()})):$(i.dom).rotate({angle:n,animateTo:r,callback:function(){console.log("rotating complete"),$(i.dom).animate({left:(t[0]-.5)*p+"px",top:(t[1]-.5)*p+"px"},1e3,"linear",(function(){i.pos=e,i.pos_index=o,i.pos_coord=t,console.log("stop moving, updating attr, pos: "+i.pos+", pos_index: "+i.pos_index+"pos_coord: "+i.pos_coord),i.set_dom_image("normal"),l()}))}})}set_dom_image(e){switch(e){case"normal":this.dom.style.backgroundImage="url(images/ship_"+this.col+".png)";break;case"active":this.dom.style.backgroundImage="url(images/ship_"+this.col+"_active.gif)";break;case"flying":this.dom.style.backgroundImage="url(images/ship_"+this.col+"_flying.gif)";break;case"complete":this.dom.style.backgroundImage="url(images/ship_"+this.col+"_complete.png)";break;case"boom":this.dom.style.backgroundImage="url(images/boom.gif)"}}hit(){config.playSound("boom");let e=this;this.mobilily=!1,this.take_off=!1,this.pos="base",this.pos_index=this.ind,this.pos_coord=s.base[this.col][this.ind],this.complete=!1,this.dom.style.transform="rotate("+this.ori_towards+"deg)",this.set_dom_image("boom"),setTimeout((function(){e.set_dom_image("normal"),e.dom.style.left=(e.pos_coord[0]-.5)*p+"px",e.dom.style.top=(e.pos_coord[1]-.5)*p+"px"}),1e3)}accomplish(){return console.log("set complete true"),this.complete=!0,this.dom.style.transform="rotate("+this.ori_towards+"deg)",this.dom.style.left=(s.base[this.col][this.ind][0]-.5)*p+"px",this.dom.style.top=(s.base[this.col][this.ind][1]-.5)*p+"px",this.set_dom_image("complete"),!!d.check_for_winner()||(config.playSound("complete"),!1)}}},function(e,o){e.exports={circle:{1:[1,5],2:[2,5],3:[3,5],4:[4,5],5:[5,4],6:[5,3],7:[5,2],8:[5,1],9:[6,1],10:[7,1],11:[8,1],12:[9,1],13:[10,1],14:[11,1],15:[11,2],16:[11,3],17:[11,4],18:[12,5],19:[13,5],20:[14,5],21:[15,5],22:[15,6],23:[15,7],24:[15,8],25:[15,9],26:[15,10],27:[15,11],28:[14,11],29:[13,11],30:[12,11],31:[11,12],32:[11,13],33:[11,14],34:[11,15],35:[10,15],36:[9,15],37:[8,15],38:[7,15],39:[6,15],40:[5,15],41:[5,14],42:[5,13],43:[5,12],44:[4,11],45:[3,11],46:[2,11],47:[1,11],48:[1,10],49:[1,9],50:[1,8],51:[1,7],52:[1,6]},straight:{2:{1:[2,8],2:[3,8],3:[4,8],4:[5,8],5:[6,8],6:[7,8]},3:{1:[8,2],2:[8,3],3:[8,4],4:[8,5],5:[8,6],6:[8,7]},4:{1:[14,8],2:[13,8],3:[12,8],4:[11,8],5:[10,8],6:[9,8]},1:{1:[8,14],2:[8,13],3:[8,12],4:[8,11],5:[8,10],6:[8,9]}},base:{2:{0:[1,4],1:[2,3],2:[2,2],3:[3,2],4:[3,3]},3:{0:[12,1],1:[13,3],2:[13,2],3:[14,2],4:[14,3]},4:{0:[15,12],1:[13,14],2:[13,13],3:[14,13],4:[14,14]},1:{0:[4,15],1:[2,14],2:[2,13],3:[3,13],4:[3,14]}},player:{1:[-4,12],2:[-4,0],3:[16,0],4:[16,12]},dice:{1:[-2.7,11.8],2:[-2.7,2.6],3:[17.2,2.6],4:[17.2,11.8]}}}]);